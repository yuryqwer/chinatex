# chinatax
本项目的目标是使用机器学习算法识别国税总局验证码。

## 数据获取
验证集和测试集必须与真实环境保持一致，因此需要从[国税总局官网](https://inv-veri.chinatax.gov.cn)上进行采集，[tag_captcha.py](./tag_captcha.py)就是用于这一目的的采集脚本，运行此脚本后会打开一个Chromium浏览器，自动填写发票代码和发票号码并等待用户在终端输入验证码的标签，输入完成后回车，验证码会自动以用户输入的标签命名图片并保存至[real_captcha](./real_captcha/)目录下。

标签的格式为`color_text`，也就是先标记颜色后标记文本内容，其中颜色`B` `U` `R` `Y`分别表示黑蓝红黄四种颜色。如果看不出图中的验证码是什么，想要换一张，直接回车即可。

此项目的训练数据起码需要百万级别的数据，光靠手动标注是不现实的，因此根据观察自己写了一套验证码生成算法，用于生成训练数据，但是生成的数据毕竟和真实数据不是一回事，所以需要引入***训练开发集***的概念，在训练数据中预留一部分作为训练开发集，如果训练后的模型在这个训练开发集上表现良好，但是在验证集上面表现不佳，说明验证码生成算法还需要改善，使其更接近官网上采集的数据。

## 数据生成
观察一下采集的数据可以发现要么是4个字符，要么是6个字符，统计下来两种比例大概是`5:9`；其中4个字符中可能包含0-2个中文字符，比例分别为`20:3:3`，6个字符中可能包含0-3个中文字符，比例分别为`6:1:1:1`，且中文字符都在最前面。

中文字符集根据采集的数据倒推，大约是700个左右，但是为了保险起见，选用更大的字符集也是没有问题的。

`{'犬', '仪', '坊', '迅', '社', '宙', '歹', '文', '纤', '访', '东', '廷', '画', '位', '后', '子', '幻', '孕', '孔', '奇', '付', '灰', '承', '代', '十', '弘', '切', '刑', '匹', '升', '豆', '坎', '妻', '庚', '工', '巧', '放', '均', '二', '午', '秀', '母', '尺', '呢', '托', '研', '私', '吃', '车', '至', '尧', '扮', '枚', '产', '合', '今', '六', '沐', '专', '仔', '材', '舟', '吸', '仓', '夫', '只', '含', '讼', '抒', '禾', '帛', '权', '侈', '幸', '王', '老', '刺', '芒', '分', '羊', '明', '纠', '杉', '杜', '佯', '羽', '丰', '议', '共', '尤', '忘', '生', '我', '舍', '伴', '孝', '板', '们', '归', '鸟', '决', '甲', '失', '邵', '页', '勾', '坦', '臣', '土', '杆', '寻', '到', '扔', '发', '久', '手', '命', '左', '始', '耳', '优', '吞', '卦', '丹', '邓', '忠', '更', '田', '汰', '邑', '酉', '七', '杖', '坡', '作', '初', '劣', '早', '店', '函', '一', '功', '火', '色', '关', '寸', '完', '弋', '许', '状', '八', '实', '季', '坪', '扑', '讦', '尾', '互', '竺', '昂', '甘', '佃', '直', '佰', '冈', '帖', '京', '呆', '丈', '呈', '乞', '上', '处', '朋', '卫', '吾', '忏', '辰', '皂', '扣', '垂', '争', '飞', '区', '戎', '入', '改', '五', '束', '洽', '沙', '四', '尸', '又', '池', '场', '过', '彼', '壮', '弟', '孟', '房', '方', '杷', '奉', '戏', '人', '弛', '米', '析', '成', '机', '委', '别', '江', '常', '些', '所', '达', '友', '古', '抑', '住', '固', '何', '虎', '阜', '姐', '炎', '虫', '光', '伺', '果', '和', '屉', '杏', '宇', '亘', '个', '宛', '牙', '肌', '乙', '吵', '吟', '出', '伶', '你', '电', '去', '征', '同', '吻', '汐', '角', '杰', '书', '讯', '白', '扶', '坐', '内', '亟', '岐', '扒', '昌', '丸', '由', '非', '居', '助', '冬', '巨', '沈', '执', '九', '父', '孙', '青', '杭', '邪', '风', '佳', '岢', '央', '男', '忝', '宕', '血', '快', '金', '吹', '定', '岭', '少', '币', '月', '汇', '政', '攻', '受', '巾', '邦', '闪', '华', '下', '侗', '列', '吉', '效', '斗', '味', '幺', '枕', '知', '训', '制', '先', '死', '并', '底', '卓', '届', '开', '来', '徇', '传', '岸', '尽', '杞', '奈', '圻', '佛', '众', '伯', '然', '丛', '戈', '汕', '阪', '爷', '姓', '务', '本', '炉', '版', '宠', '弄', '沛', '忙', '毛', '存', '三', '圣', '戊', '贝', '必', '问', '妆', '竹', '气', '此', '宋', '形', '卒', '岑', '希', '丁', '门', '汪', '宏', '亢', '记', '究', '军', '佻', '兵', '兆', '么', '侄', '岳', '为', '字', '他', '杯', '且', '长', '皮', '言', '力', '伽', '舌', '局', '服', '与', '让', '具', '夕', '昏', '林', '身', '足', '步', '武', '券', '灭', '系', '其', '讲', '考', '式', '夜', '使', '朵', '吴', '弓', '妓', '炊', '设', '府', '卷', '立', '衣', '击', '床', '亡', '伸', '例', '户', '汾', '忽', '周', '习', '巫', '沃', '卧', '西', '旦', '布', '牛', '动', '享', '地', '礼', '宗', '念', '自', '以', '亿', '佬', '会', '松', '协', '百', '井', '屈', '冶', '农', '刻', '行', '乡', '采', '对', '良', '志', '中', '全', '北', '李', '估', '瓜', '肋', '宝', '兔', '岱', '易', '枇', '的', '在', '侃', '于', '云', '宜', '水', '用', '及', '妲', '咏', '叶', '乎', '伟', '坤', '兴', '役', '日', '物', '仟', '予', '干', '厂', '台', '约', '巡', '冷', '闭', '也', '吝', '龙', '汝', '两', '昔', '毕', '凤'}`